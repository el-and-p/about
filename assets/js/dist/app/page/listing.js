define("util/scroller",["jquery","easing","pubsub"],function(t){return{init:function(){this._initSubscriptions()},_initSubscriptions:function(){t.subscribe("/scroller/move",this._moveToElement)},_moveToElement:function(i){var n=t(i.element);t("html,body").animate({scrollTop:n.offset().top-80},500,"easeInOutExpo")}}}),define("app/page/detail",["jquery"],function(t){var i;return{init:function(){i=this,this._initSubscriptions(),t(".js-listing").length||this._setUp()},_initSubscriptions:function(){t.subscribe("/detail/init",this._setUp)},_setUp:function(){i._initEqualisation(),i._initTabs()},_initEqualisation:function(){require(["app/ui/equalisation/equalisation"],function(t){t.init()})},_initTabs:function(){t(".js-tabbery").length&&require(["app/ui/tabs/load"],function(t){t.init()})}}}),define("util/contentManager",["jquery"],function(t){var i={};return{getContent:function(n){var e=t.Deferred();return i[n]?e.resolveWith(this,[i[n]]):t.ajax({url:n}).done(function(t){e.resolveWith(this,[t]),i[n]=t}),e.promise()}}}),define("app/ui/grid/content",["jquery","util/contentManager","pubsub"],function(t,i){var n,e,o;return{init:function(){n=this,e=t(".grid"),o=e.children(".js-grid__item"),this._initEvents()},_initEvents:function(){e.on("click",".js-grid__item",this._processShowContentEvent)},_processShowContentEvent:function(e){e.preventDefault();var s=t(this);if(!s.is(".is-selected")){var a=o.index(s),r=s.find("a").first()[0].href;i.getContent(r).done(n._processContent),t.publish("/content/new",[{index:a}])}},_processContent:function(i){var n=t(i).find(".js-content"),e=t("<div />").append(n.clone()).html(),o={html:e};t.publish("/content/ready",[o])}}}),define("app/ui/grid/positioner",["jquery","pubsub","throttledebounce"],function(t){var i,n,e,o;return{init:function(){i=this,n=t(".js-grid__item"),o=t(".js-modal--inline"),this._initEvents(),this._initSubscriptions()},_initEvents:function(){t(window).on("resize",t.throttle(250,this._resizeGrid))},_initSubscriptions:function(){t.subscribe("/content/new",this._processNewContentEvent)},_resizeGrid:function(){var o=n.filter(".is-selected");if(o.length){var s={index:n.index(o)};i._generatePositioningData(s,!1),t.publish("/modal/resize",[e])}},_processNewContentEvent:function(n){i._generatePositioningData(n,!0),t.publish("/modal/show",[e])},_generatePositioningData:function(t,o){var s=t.index,a=n.eq(s),r=i._getLastItemInRow(a);o&&i._cleanUpPreviousItem(),i._setCurrentClass(a),i._setLastClass(r),e=i._getLastItemData(r,a)},_cleanUpPreviousItem:function(){n.filter(".is-selected").attr("style","").removeClass("is-selected"),n.filter(".js-grid__item--end").removeClass("js-grid__item--end")},_setCurrentClass:function(t){t.addClass("is-selected")},_getLastItemInRow:function(i){var n=i,e=i.nextAll(),o=i.offset().top;return e.each(function(){var i=t(this),e=i.offset().top;return e!=o?(n=i,!1):(i.next().length||(n=i),void 0)}),e.length?n.prev():n},_setLastClass:function(t){t.addClass("js-grid__item--end")},_getLastItemData:function(t,i){var n={},e=t.offset().top,s=t.outerHeight();o.outerHeight(),o.offset().top,i.position().top;var a=e+s+40;return n.offset=a,n.position=this._getClickedItemPosition(i),n},_getClickedItemPosition:function(i){var e={"arrow-one-0":"arrow-one-center","arrow-two-0":"arrow-two-left","arrow-two-1":"arrow-two-right","arrow-three-0":"arrow-three-left","arrow-three-1":"arrow-three-center","arrow-three-2":"arrow-three-right"},o=i.offset().top;$rowItems=n.filter(function(){return t(this).offset().top===o});var s=$rowItems.index(i);return 3===$rowItems.length?e["arrow-three-"+s]:2===$rowItems.length?e["arrow-two-"+s]:e["arrow-one-"+s]}}}),define("app/ui/grid/modal",["jquery","pubsub"],function(t){var i,n,e,o;return{init:function(){i=this,e=t(".js-modal--inline"),n=t(".js-grid"),o=t(".js-modal__close"),this._initSubscriptions(),this._initEvents()},_initSubscriptions:function(){t.subscribe("/modal/show",this._positionAndShowModal),t.subscribe("/modal/resize",this._positionAndShowModal),t.subscribe("/content/ready",this._loadContent)},_initEvents:function(){o.on("click",this._closeModal)},_positionAndShowModal:function(t){i._positionModal(t.offset),i._setArrow(t.position),i._setSpacingForModal(),i._showModal(),i._scrollToItem(e),setTimeout(function(){i._lazyLoadImages(e)},500)},_loadContent:function(i){var n=i.html;e.find(".js-modal__body").empty().append(n),t.publish("/detail/init")},_positionModal:function(t){e.css("top",t)},_setSpacingForModal:function(){e.css({visibility:"hidden",display:"block"}),setTimeout(function(){n.find(".js-grid__item.is-selected").css({"margin-bottom":e.outerHeight()+60})},400),e.css({visibility:"visible",display:"none"})},_setArrow:function(t){e[0].className=e[0].className.replace(/arrow\-(one|two|three)+\-(left|center|right)+/gi,""),e.addClass(t)},_closeModal:function(){var t=n.find(".js-grid__item.is-selected");i._scrollToItem(t),t.removeClass("is-selected").attr("style",""),n.find(".js-grid__item--end").removeClass("js-grid__item--end"),i._hideModal()},_showModal:function(){e.show()},_hideModal:function(){e.hide()},_scrollToItem:function(i){t.publish("/scroller/move",[{element:i}])},_lazyLoadImages:function(){var i=e.find(".js-modal__body").find("img");i.length&&t.publish("/lazyload/image",[i])}}}),define("app/page/listing",["jquery","util/scroller","app/page/detail","app/ui/grid/content","app/ui/grid/positioner","app/ui/grid/modal"],function(t,i,n,e,o,s){i.init(),n.init(),e.init(),o.init(),s.init()});
//# sourceMappingURL=listing.js.map